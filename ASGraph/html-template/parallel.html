<html>
  <head>
    <script type="text/javascript" src="protovis-r3.2.js"></script>
    <style type="text/css">


#title {
  position: absolute;
  top: 70px;
  left: 200px;
  padding: 10px;
  background: white;
}

large {
  font-size: medium;
}

    </style>
  </head>
  <body>
    <script type="text/javascript+protovis">

	var dimIds = new Array();
	for(var sg in parent.selectedGroups){
		for(var rg in parent.varData[sg].related){
			dimIds.push(parent.varData[sg].related[rg]);
		}
	}
	
var dims = pv.range(dimIds.length).map(function(i) { return parent.varData[dimIds[i]].varName; });

var data = new Array();
for(var i = 0; i < dimIds.length; ++i){
	var o = new Object();
	for(var j = 0; j < dimIds.length; ++j){
		if(dims[j] == parent.varData[dimIds[i]].varName){
			o[dims[i]] = parent.varData[dimIds[i]].values[parent.zoomIdx];
			if(o[dims[i]] == null){ o[dims[i]] = 0; }
		}
		else { o[dims[j]] = 0; }
	}
	data.push(o);
}

/* Sizing and scales. */
var w = 200*dims.length,
    h = 200,
    color = pv.Colors.category10(),
   	x = pv.Scale.ordinal(dims).splitFlush(0, w),
	y = pv.dict(dims, function(t) pv.Scale.linear()
	        .domain(data.filter(function(d) !isNaN(d[t])), function(d) d[t])
	        .range(0, h));

	/* The root panel. */
	var vis = new pv.Panel()
	    .width(w)
	    .height(h)
	    .margin(20)
	    .bottom(40);

	/* Rule and labels per dimension. */
	var rule = vis.add(pv.Rule)
	    .data(dims)
	    .left(x)
	    .strokeStyle(function() parent.colorArray[this.index])
	    .lineWidth(2);

	rule.anchor("top").add(pv.Label)
	    .text(function(t) y[t].domain()[0]);

	rule.anchor("bottom").add(pv.Label)
	    .text(function(t) y[t].domain()[1]);

	rule.anchor("bottom").add(pv.Label)
	    .textStyle(function() parent.colorArray[this.index])
	    .textMargin(14);
	
	rule.anchor("bottom").add(pv.Label)
		.top(h+23)
	    .text(function(t) "I = 1.0, CC | GC");

	/* Parallel coordinates. */
	vis.add(pv.Panel)
	    .data(data)
	  .add(pv.Line)
	    .data(dims)
	    .left(function(t, d) x(t))
	    .bottom(function(t, d) y[t](d[t]))
		.interpolate(function() "cardinal")
		.segmented(function() false)
	    .strokeStyle("rgba(0, 0, 0, .2)")
		.tension(0.5)
	    .lineWidth(1);
	
	/*scatterplot in between coordinates */
	var sPanel = vis.add(pv.Panel)
		.data(dims)
		.left(x)
		.width(w)
		.height(h);
	
	sPanel.add(pv.Dot)
		.data(data)
		.def("x", function(k0, k1) pv.Scale.linear(data, function(d) d[k0]).range(0, w))
	    .def("y", function(k0, k1) pv.Scale.linear(data, function(d) d[k1]).range(0, w))
	    .left(function(d, k0, k1) this.x(data[sPanel.index]))
	    .bottom(function(d, k0, k1) this.y()(data[sPanel.index]))
		.strokeStyle(function() parent.colorArray[sPanel.index] );
		
	vis.render();

    </script></body>
</html>
