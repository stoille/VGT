<html>
  <head>
    <script type="text/javascript" src="protovis-r3.2.js"></script>
	<script type="text/javascript" src="Metrics.js"></script>
    <style type="text/css">


#title {
  position: absolute;
  top: 70px;
  left: 200px;
  padding: 10px;
  background: white;
}

large {
  font-size: medium;
}

    </style>
  </head>
  <body>
    <script type="text/javascript+protovis">
	
	var dimIds = new Array();
	for(var sg in parent.selectedGroupsArray){
		var selectedGroup = parent.selectedGroupsArray[sg];
		for(var rg in selectedGroup.related){
			dimIds.push(selectedGroup.related[rg]);
		}
	}
	
var dims = pv.range(dimIds.length).map(function(i) { return parent.varData[dimIds[i]].varName; });

var data = new Array();
for(var i = 0; i < dimIds.length; ++i){
	var o = new Object();
	for(var j = 0; j < dimIds.length; ++j){
		if(dims[j] == parent.varData[dimIds[i]].varName){
			o[dims[j]] = parent.varData[dimIds[i]].values[parent.zoomIdx];
			if(o[dims[j]] == null){ o[dims[i]] = 0; }
		}
		else { o[dims[j]] = 0; }
	}
	data.push(o);
}

/* Sizing and scales. */
var w = 200*dims.length,
    h = 225,
    color = pv.Colors.category10(),
   	x = pv.Scale.ordinal(dims).splitFlush(0, w),
	y = pv.dict(dims, function(t) pv.Scale.linear()
	        .domain(data.filter(function(d) !isNaN(d[t])), function(d) d[t])
	        .range(0, h));

	/* The root panel. */
	var vis = new pv.Panel()
	    .width(w)
	    .height(h)
	    .margin(20)
	    .bottom(40);

	/* Rule and labels per dimension. */
	var rule = vis.add(pv.Rule)
	    .data(dims)
	    .left(x)
	    .strokeStyle(function() parent.colorArray[this.index])
	    .lineWidth(2);

	rule.anchor("top").add(pv.Label)
	    .text(function(t) y[t].domain()[0]);

	rule.anchor("bottom").add(pv.Label)
	    .text(function(t) y[t].domain()[1]);

	rule.anchor("bottom").add(pv.Label)
	    .textStyle(function() parent.colorArray[this.index])
	    .textMargin(14);
	
	rule.anchor("top").add(pv.Label)
		.top(-10)
		.left(function(t) x(t) + (x(dims[1])- x(dims[0]))/2 )
	    .text(function(t) (this.index < parent.selectedGroupsArray.length-1) ? "P = "+FindCorrelation(parent.selectedGroupsArray[this.index].values,parent.selectedGroupsArray[this.index+1].values) : "");

	/* Parallel coordinates. */
	vis.add(pv.Panel)
	    .data(data)
	  .add(pv.Line)
	    .data(dims)
	    .left(function(t, d) x(t))
	    .bottom(function(t, d) y[t](d[t]))
		.interpolate(function() "cardinal")
		.segmented(function() false)
	    .strokeStyle("rgba(0, 0, 0, .2)")
		.tension(0.5)
	    .lineWidth(1);
	
	/*scatterplot in between coordinates */
	var sPanel = vis.add(pv.Panel)
		.data(dims)
		.left(x)
		.width(w)
		.height(h);
	
	sPanel.add(pv.Dot)
		.data(data)
		.def("y", function(t) pv.Scale.linear(data, function(d) d[dims[sPanel.index]]).range(0,200) ) 
		.def("x", function(t) pv.Scale.linear(data, function(d) d[dims[sPanel.index+1]]).range(0,200) ) 
		.left(function(t) this.x(sPanel.index))
		.bottom(function(t) this.y()(sPanel.index+1))
		.strokeStyle(function() parent.colorArray[sPanel.index] );
		
	vis.render();

    </script></body>
</html>
